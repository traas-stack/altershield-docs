<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-altershield-operator/advanced-usage">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Advanced Usage | AlterShield</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/altershield-operator/advanced-usage"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Advanced Usage | AlterShield"><meta data-rh="true" name="description" content="This document introduces the advanced features of AlterShield Operator."><meta data-rh="true" property="og:description" content="This document introduces the advanced features of AlterShield Operator."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/altershield-operator/advanced-usage"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/altershield-operator/advanced-usage" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/zh-CN/altershield-operator/advanced-usage" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/altershield-operator/advanced-usage" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6a91212d.css">
<link rel="preload" href="/assets/js/runtime~main.47f83024.js" as="script">
<link rel="preload" href="/assets/js/main.dc9f7d03.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="AlterShield" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="AlterShield" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/altershield-operator/advanced-usage" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-CN/altershield-operator/advanced-usage" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中文（中国)</a></li></ul></div><a href="https://github.com/traas-stack/altershield" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/quick-start/start-with-docker">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/open-change-management-specification/overview">Open Change Management Specification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/change-defender/what-is-change-defender">Change Defender</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/altershield-operator/what-is-altershield-operator">AlterShield Operator</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/altershield-operator/what-is-altershield-operator">What is AlterShield Operator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/altershield-operator/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/altershield-operator/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/altershield-operator/quick-deploy">Quick Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/altershield-operator/user-guide">User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/altershield-operator/advanced-usage">Advanced Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/altershield-operator/overall-design">Overall Design</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AlterShield Operator</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Advanced Usage</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Advanced Usage</h1><p>This document introduces the advanced features of AlterShield Operator.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-crd-in-altershield-operator">1. CRD in AlterShield Operator<a href="#1-crd-in-altershield-operator" class="hash-link" aria-label="Direct link to 1. CRD in AlterShield Operator" title="Direct link to 1. CRD in AlterShield Operator">​</a></h2><p><strong>Currently, there are three CRDs defined in AlterShield Operator:</strong></p><ul><li>opsconfiginfoes.app.ops.cloud.alipay.com (referred to as oopsconfiginfoes)</li><li>changeworkloads.app.ops.cloud.alipay.com (referred to as ochangeworkloads)</li><li>changepods.app.ops.cloud.alipay.com (referred to as ochangepods)</li></ul><p><strong>The YAML files are saved in the config/crd/bases directory.</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-opsconfiginfoes">1.1 opsconfiginfoes<a href="#11-opsconfiginfoes" class="hash-link" aria-label="Direct link to 1.1 opsconfiginfoes" title="Direct link to 1.1 opsconfiginfoes">​</a></h3><p><strong>opsconfiginfoes is used to configure the configuration information of AlterShield Operator.</strong></p><ul><li>Run the following command to view opsconfiginfoes:</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get opsconfiginfo -n altershieldoperator-system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>There are two configuration information, which are:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME       AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blocking   25h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">branch     25h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="111-blocking-configuration">1.1.1 Blocking Configuration<a href="#111-blocking-configuration" class="hash-link" aria-label="Direct link to 1.1.1 Blocking Configuration" title="Direct link to 1.1.1 Blocking Configuration">​</a></h4><p><strong>When AlterShield detects abnormalities in a pod, AlterShield Operator will block the pod according to the blocking configuration information.</strong></p><ul><li>Run the following command to view the blocking configuration information:</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get opsconfiginfo blocking -n altershieldoperator-system -o yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>The content of the blocking configuration information is as follows:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: app.ops.cloud.alipay.com/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: OpsConfigInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  creationTimestamp: &quot;2023-05-11T07:29:49Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  generation: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: blocking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: altershieldoperator-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceVersion: &quot;197897&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uid: 213514db-33d0-4289-8d56-e3dea227e9c1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remark: Enabling Blockade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: isBlockingUp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>.spec.type is isBlockingUp, indicating whether blocking is enabled</li><li>.spec.enable is true, indicating that blocking is <strong>enabled</strong> (default configuration).</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="note">Note<a href="#note" class="hash-link" aria-label="Direct link to Note" title="Direct link to Note">​</a></h5><ul><li>You can manually set .spec.enable to false to disable blocking.</li><li>When .spec.enable is false, if an exception occurs, the deployment will be released normally without blocking.</li><li>If a deployment has been blocked, it will not be released normally when .spec.enable is false.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="112-batch-control-configuration">1.1.2 Batch Control Configuration<a href="#112-batch-control-configuration" class="hash-link" aria-label="Direct link to 1.1.2 Batch Control Configuration" title="Direct link to 1.1.2 Batch Control Configuration">​</a></h4><p><strong>ChangePod will report pod information to AlterShield. This configuration determines whether to enable batch control. When it is turned off, there will be only one pod&#x27;s information in each ChangePod. When it is turned on, there will be multiple pods&#x27; information in each ChangePod (under construction).</strong></p><ul><li>Run the following command to view the branch configuration information:</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get opsconfiginfo branch -n altershieldoperator-system -o yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>The content of the branch configuration information is as follows:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: app.ops.cloud.alipay.com/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: OpsConfigInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  creationTimestamp: &quot;2023-05-11T07:29:50Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  generation: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: branch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: altershieldoperator-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceVersion: &quot;197898&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uid: 2d18dc78-f65f-484c-8f7b-ea5e87c83fe2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content: &quot;10&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remark: Enabling Batch Protection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: isBranch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>.spec.type is isBranch, indicating whether batch control is enabled.</li><li>.spec.enable is false, indicating that batch control is <strong>disabled</strong> (default configuration).</li><li>.spec.content is 10, indicating that the threshold for batch control is 10.</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="note-1">Note<a href="#note-1" class="hash-link" aria-label="Direct link to Note" title="Direct link to Note">​</a></h5><ul><li>.spec.enable cannot be manually set to true at present.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-changeworkloads">1.2 changeworkloads<a href="#12-changeworkloads" class="hash-link" aria-label="Direct link to 1.2 changeworkloads" title="Direct link to 1.2 changeworkloads">​</a></h3><p><strong>changeworkloads maps the changing workloads in the cluster, currently supporting Deployment.</strong></p><p><img loading="lazy" alt="changeworkload-status.png" src="/assets/images/changeworkload-status-1af6cfd7def5d417d724374c0e94f426.png" width="564" height="395" class="img_ev3q"></p><p><strong>The changeworkload has the following states:</strong></p><ul><li>Init：Initialization state. When a new controlled workload is created, it enters this state.</li><li><ul><li>When in this state, if the upload to AlterShield is successful (default), it will enter the Running state.</li></ul></li><li><ul><li>When in this state, if the upload to AlterShield fails (under construction), it will enter the Failed state.</li></ul></li><li>Running：Running state.</li><li><ul><li>When in this state, if the number of Finished pods reaches the threshold (not enabled by default, the number is 1), a ChangePod will be created.</li></ul></li><li>Failed：Failed state.</li><li><ul><li>It will not check the current version until the version changes. The new changeworkload will re-enter the Init state.</li></ul></li><li>TimeOutPreThreshold：Timeout status before threshold.</li><li><ul><li>When the <a href="/altershield-operator/advanced-usage#112-batch-control-configuration">Batch Control Configuration</a> of AlterShield Operator is FALSE，
if the workload is in the Running state and the number of Finished pods has not reached 1 before reaching the threshold time (default 1 minute), it will enter this status.</li></ul></li><li><ul><li>When the <a href="/altershield-operator/advanced-usage#112-batch-control-configuration">Batch Control Configuration</a> of AlterShield Operator is TRUE,
if the workload is in the Running state and the number of Finished pods has not reached the configured number (default 10) before reaching the threshold time (default 1 minute), it will enter this status.</li></ul></li><li>Success：Success status.</li><li><ul><li>When all pods are in the Finished state and all pods pass the AlterShield detection, it will enter this status.</li></ul></li><li><ul><li>When unable to report to AlterShield during protection, it will also be considered pass, and only when explicitly returned as abnormal will it enter the fail state.</li></ul></li><li><ul><li>When there is a successful changeworkload, the historical versions of the changeworkload resources will be deleted.</li></ul></li><li>Suspend：Suspended status.</li><li><ul><li>When all pods are in the Finished state and there is a pod that does not pass the AlterShield detection, it will enter this status.</li></ul></li><li><ul><li>When changeworkload is in the Suspend state, it will block the normal deployment of the subsequent Workload resources, and this can be turned off by modifying the <a href="/altershield-operator/advanced-usage#111-blocking-configuration">Blocking Configuration</a></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-changepods">1.3 changepods<a href="#13-changepods" class="hash-link" aria-label="Direct link to 1.3 changepods" title="Direct link to 1.3 changepods">​</a></h3><p><strong>changepods is a mapping of the changing pods in the cluster, with at least one pod corresponding to a changepod.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-blocking-and-repairing-releases">2. Blocking and Repairing Releases<a href="#2-blocking-and-repairing-releases" class="hash-link" aria-label="Direct link to 2. Blocking and Repairing Releases" title="Direct link to 2. Blocking and Repairing Releases">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-the-changepod-status-to-simulate-an-exceptional-case">Modifying the changePod Status to Simulate an Exceptional Case<a href="#modifying-the-changepod-status-to-simulate-an-exceptional-case" class="hash-link" aria-label="Direct link to Modifying the changePod Status to Simulate an Exceptional Case" title="Direct link to Modifying the changePod Status to Simulate an Exceptional Case">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-altershield-is-not-configured-exceptional-cases-can-only-be-manually-simulated">When AlterShield is not configured, exceptional cases can only be manually simulated.<a href="#when-altershield-is-not-configured-exceptional-cases-can-only-be-manually-simulated" class="hash-link" aria-label="Direct link to When AlterShield is not configured, exceptional cases can only be manually simulated." title="Direct link to When AlterShield is not configured, exceptional cases can only be manually simulated.">​</a></h4><ul><li>Run the command</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get changepods sleep--x--c6c45d23c098bdf181853a85b60b5d74--x--1 -o yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Observe the output</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app.ops.cloud.alipay.com/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ChangePod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">creationTimestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-05-11T07:46:13Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">generation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">admission-webhook-altershield.antgroup.com/version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> c6c45d23c098bdf181853a85b60b5d74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/deployment-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c6c45d23c098bdf181853a85b60b5d74</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">-1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ownerReferences</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app.ops.cloud.alipay.com/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">blockOwnerDeletion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">controller</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ChangeWorkload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c6c45d23c098bdf181853a85b60b5d74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">uid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a9b8b77c</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ebaa</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">48d7</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">915f</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bb8c02f5ce91</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resourceVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;199426&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">uid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 09907f64</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">4eb8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">47da</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b46d</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">5ac0427ebf80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">changeWorkloadId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c6c45d23c098bdf181853a85b60b5d74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">createTime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-05-11 15:46:13&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">createTimeUnix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1683791173</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">podInfos</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">5c698f4449</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fsb27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.244.1.198</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">5c698f4449</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fsb27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workSpace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PreFailed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ExecuteDone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateTime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-05-11 15:46:17&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateTimeUnix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1683791177</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Retrieve the .spec.podInfos field and modify the status content</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch changepod --subresource=status sleep--x--c6c45d23c098bdf181853a85b60b5d74--x--1 -p &#x27;{&quot;status&quot;:{&quot;podResults&quot;:[{&quot;app&quot;:&quot;sleep&quot;,&quot;hostName&quot;:&quot;sleep-5c698f4449-fsb27&quot;,&quot;ip&quot;:&quot;10.244.1.198&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;pod&quot;:&quot;sleep-5c698f4449-fsb27&quot;,&quot;workSpace&quot;:&quot;default&quot;,&quot;verdict&quot;:&quot;unpass&quot;,&quot;message&quot;:&quot;find error&quot;}], &quot;message&quot;: &quot;PostFinish&quot;}}&#x27; --type merge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Re-observe the ChangePod and ChangeWorkload resources</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get changepods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get changeworkloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get changeworkloads -o yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get deployment sleep -o yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                               STATUS        MESSAGE      CREATETIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--c6c45d23c098bdf181853a85b60b5d74--x--1   ExecuteDone   PostFinish   2023-05-11 15:46:13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--c6c45d23c098bdf181853a85b60b5d74--x--2   ExecuteDone   PreFailed    2023-05-11 15:46:14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--c6c45d23c098bdf181853a85b60b5d74--x--3   ExecuteDone   PreFailed    2023-05-11 15:46:14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--c6c45d23c098bdf181853a85b60b5d74--x--4   ExecuteDone   PreFailed    2023-05-11 15:46:15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--c6c45d23c098bdf181853a85b60b5d74--x--5   ExecuteDone   PreFailed    2023-05-11 15:46:15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         STATUS    CREATETIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--c6c45d23c098bdf181853a85b60b5d74   Suspend   2023-05-11 15:46:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">items:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- apiVersion: app.ops.cloud.alipay.com/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ChangeWorkload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metadata: ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  spec: ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    defenseCheckFailPods:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - app: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hostName: sleep-5c698f4449-fsb27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ip: 10.244.1.198</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      message: find error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pod: sleep-5c698f4449-fsb27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      verdict: unpass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      workSpace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceVersion: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    admission-webhook-altershield.antgroup.com/version: c6c45d23c098bdf181853a85b60b5d74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    altershield.defense.antgroup.com/defense-status: processed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    altershield.defense.antgroup.com/suspend: &quot;1683791175&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec: ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">status: ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>The <strong>status</strong> field of the ChangePod resource being <strong>ExecuteDone</strong> means that the run check has been completed.</li><li>The <strong>message</strong> field of the ChangePod resource being <strong>PostFinish</strong> means that the check was successful.</li><li>The <strong>status</strong> field of the ChangeWorkload resource being <strong>Suspend</strong> means that an exception was detected during the release and subsequent releases have been suspended.</li><li>The <strong>status.defenseCheckFailPods</strong> field of the ChangeWorkload resource contains information about all the pods that failed the check.</li><li>The <strong>labels.altershield.defense.antgroup.com/suspend</strong> field of the Deployment resource being <strong>1683791175</strong> means that the release was suspended at that timestamp.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-the-deployment-resource-to-simulate-a-normal-release">Modifying the Deployment Resource to Simulate a Normal Release<a href="#modifying-the-deployment-resource-to-simulate-a-normal-release" class="hash-link" aria-label="Direct link to Modifying the Deployment Resource to Simulate a Normal Release" title="Direct link to Modifying the Deployment Resource to Simulate a Normal Release">​</a></h3><ul><li>Run the command</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch deployment sleep -p &#x27;{&quot;spec&quot;:{&quot;template&quot;:{&quot;metadata&quot;:{&quot;labels&quot;:{&quot;test&quot;:&quot;test&quot;}}}}}&#x27; --type merge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>This will trigger the Webhook interception.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error from server (deployment sleep is suspended): admission webhook &quot;vdeployment.kb.io&quot; denied the request: deployment sleep is suspended</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>At this point, the release has been suspended and needs to be repaired before normal releases can continue.</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-the-deployment-resource-to-simulate-a-repair-release">Modifying the Deployment Resource to Simulate a Repair Release<a href="#modifying-the-deployment-resource-to-simulate-a-repair-release" class="hash-link" aria-label="Direct link to Modifying the Deployment Resource to Simulate a Repair Release" title="Direct link to Modifying the Deployment Resource to Simulate a Repair Release">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">altershield.defense.antgroup.com/ignored-suspend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1234&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/sleep&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;infinity&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IfNotPresent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Run the command</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f ./config/samples/sleep.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>The command executes successfully.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/sleep configured</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Repair the sleep Deployment resource by adding the <strong>altershield.defense.antgroup.com/ignored-suspend</strong> field.</li><li>The interception function will be ignored and the release will enter the release process.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-changeworkload-resource">View the ChangeWorkload Resource<a href="#view-the-changeworkload-resource" class="hash-link" aria-label="Direct link to View the ChangeWorkload Resource" title="Direct link to View the ChangeWorkload Resource">​</a></h3><ul><li>Run the command</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get changeworkloads</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>At this point, two versions of the ChangeWorkload resource exist simultaneously.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         STATUS    CREATETIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--6a8ff823a5011291b0f02a1d83c2222d   Running   2023-05-12 14:24:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--c6c45d23c098bdf181853a85b60b5d74   Suspend   2023-05-12 11:02:28</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>After waiting for some time, run the command again.</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get changeworkloads</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>At this point, only the latest Success version of the ChangeWorkload resource exists.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         STATUS    CREATETIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep--x--6a8ff823a5011291b0f02a1d83c2222d   Success   2023-05-12 14:24:12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Modify the Deployment resource again to simulate a normal release.</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch deployment sleep -p &#x27;{&quot;spec&quot;:{&quot;template&quot;:{&quot;metadata&quot;:{&quot;labels&quot;:{&quot;test&quot;:&quot;test&quot;}}}}}&#x27; --type merge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>The normal release is successful.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/sleep patched</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-self-healing-rollback">3. Self-healing rollback<a href="#3-self-healing-rollback" class="hash-link" aria-label="Direct link to 3. Self-healing rollback" title="Direct link to 3. Self-healing rollback">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-fails-to-be-deployed-successfully">Deployment fails to be deployed successfully.<a href="#deployment-fails-to-be-deployed-successfully" class="hash-link" aria-label="Direct link to Deployment fails to be deployed successfully." title="Direct link to Deployment fails to be deployed successfully.">​</a></h3><ul><li>Refer to the <a href="/altershield-operator/quick-start#self-healing-rollback">self-healing-rollback</a> section in the Quick Start documentation for more information.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites-for-triggering-the-current-self-healing-rollback-feature">Prerequisites for triggering the current self-healing rollback feature:<a href="#prerequisites-for-triggering-the-current-self-healing-rollback-feature" class="hash-link" aria-label="Direct link to Prerequisites for triggering the current self-healing rollback feature:" title="Direct link to Prerequisites for triggering the current self-healing rollback feature:">​</a></h4><ul><li><ol><li>During the deployment process, if a Pod fails to start <strong>(does not reach the Running state)</strong> for more than the threshold time (default is 2 minutes).</li></ol></li><li><ol start="2"><li>The deployment resource is in the default <strong>RollingUpdate</strong> deployment strategy and cannot be <strong>Recreate</strong>.</li></ol></li><li><ol start="3"><li>The current deployment has two running ReplicaSets simultaneously, and the old version of the ReplicaSet is in the <strong>normal</strong> state.</li></ol></li><li><ol start="4"><li>Once the threshold time is reached, the current deployment is considered a failure, and the self-healing rollback feature is triggered. It will roll back to the old version of the ReplicaSet.</li></ol></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-successful-deployment-under-construction">Deployment successful deployment (under construction).<a href="#deployment-successful-deployment-under-construction" class="hash-link" aria-label="Direct link to Deployment successful deployment (under construction)." title="Direct link to Deployment successful deployment (under construction).">​</a></h3><ul><li>Refer to the scenario <a href="/altershield-operator/advanced-usage#2-blocking-and-repairing-releases">2-blocking-and-repairing-releases</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-of-the-current-self-healing-rollback-feature">Description of the current self-healing rollback feature:<a href="#description-of-the-current-self-healing-rollback-feature" class="hash-link" aria-label="Direct link to Description of the current self-healing rollback feature:" title="Direct link to Description of the current self-healing rollback feature:">​</a></h4><ul><li><ol><li>During the deployment process, if a Pod starts normally <strong>(reaches the Running state)</strong> and the deployment resource is successfully deployed.</li></ol></li><li><ol start="2"><li>There are <strong>no restrictions</strong> on the deployment strategy of the deployment resource.</li></ol></li><li><ol start="3"><li>There is a successful version in the deployment history <strong>(ChangeWorkload is Success)</strong>.</li></ol></li><li><ol start="4"><li>If there is any Pod information in the ChangePod resource and AlterShield that <strong>fails</strong> to pass the check.</li></ol></li><li><ol start="5"><li>If the current version of the ChangeWorkload resource is in <strong>Suspend</strong> state, it is considered an abnormal deployment, and the self-healing rollback feature is triggered.</li></ol></li><li><ol start="6"><li>It will roll back to the latest successfully deployed version in the deployment history.</li></ol></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pending-related-instructions">Pending related instructions:<a href="#pending-related-instructions" class="hash-link" aria-label="Direct link to Pending related instructions:" title="Direct link to Pending related instructions:">​</a></h4><ul><li><ol><li>Trigger timing：Please refer to the documentation <a href="/altershield-operator/advanced-usage#modifying-the-deployment-resource-to-simulate-a-repair-release">Modifying the Deployment Resource to Simulate a Normal Release</a>，When an abnormal deployment is detected, normal deployment will be prevented, and reparative deployment will be allowed. Therefore, it will be exposed as an interface for users to trigger manually.</li></ol></li><li><ol start="2"><li>Deployment history：Currently, the version of ReplicaSet in Deployment is mainly used for judgment, but this version can only be partially retained and may not meet the needs of users. Therefore, we will consider adding the functionality of customizing the number of versions to be retained.</li></ol></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/altershield-operator/user-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">User Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/altershield-operator/overall-design"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overall Design</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-crd-in-altershield-operator" class="table-of-contents__link toc-highlight">1. CRD in AlterShield Operator</a><ul><li><a href="#11-opsconfiginfoes" class="table-of-contents__link toc-highlight">1.1 opsconfiginfoes</a></li><li><a href="#12-changeworkloads" class="table-of-contents__link toc-highlight">1.2 changeworkloads</a></li><li><a href="#13-changepods" class="table-of-contents__link toc-highlight">1.3 changepods</a></li></ul></li><li><a href="#2-blocking-and-repairing-releases" class="table-of-contents__link toc-highlight">2. Blocking and Repairing Releases</a><ul><li><a href="#modifying-the-changepod-status-to-simulate-an-exceptional-case" class="table-of-contents__link toc-highlight">Modifying the changePod Status to Simulate an Exceptional Case</a></li><li><a href="#modifying-the-deployment-resource-to-simulate-a-normal-release" class="table-of-contents__link toc-highlight">Modifying the Deployment Resource to Simulate a Normal Release</a></li><li><a href="#modifying-the-deployment-resource-to-simulate-a-repair-release" class="table-of-contents__link toc-highlight">Modifying the Deployment Resource to Simulate a Repair Release</a></li><li><a href="#view-the-changeworkload-resource" class="table-of-contents__link toc-highlight">View the ChangeWorkload Resource</a></li></ul></li><li><a href="#3-self-healing-rollback" class="table-of-contents__link toc-highlight">3. Self-healing rollback</a><ul><li><a href="#deployment-fails-to-be-deployed-successfully" class="table-of-contents__link toc-highlight">Deployment fails to be deployed successfully.</a></li><li><a href="#deployment-successful-deployment-under-construction" class="table-of-contents__link toc-highlight">Deployment successful deployment (under construction).</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 AlterShield.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.47f83024.js"></script>
<script src="/assets/js/main.dc9f7d03.js"></script>
</body>
</html>